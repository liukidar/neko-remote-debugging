# Neko configuration for lightweight video streaming
# For detailed configuration options, please refer to the Neko documentation:
# https://neko.m1k1o.net/docs/v3/configuration#file

desktop:
  screen: "1024x768@15"

member:
  provider: anonymous
  anonymous:
    # Allow anyone to connect with full permissions
    can_login: true
    can_connect: true
    can_watch: true
    can_host: true
    can_share_media: true
    can_access_clipboard: true
    sends_inactive_cursor: false
    can_see_inactive_cursors: false

session:
  merciful_reconnect: true
  implicit_hosting: true   # Autoâ€‘host without UI interaction
  auto_login: true         # Automatically log in users
  auto_connect: true       # Automatically connect to the stream
  auto_play: true          # Automatically start video playback
  cookie:
    enabled: false

# Add webrtc section for autoplay
webrtc:
  auto_play: true          # Force WebRTC autoplay
  
# Add client settings for autoplay
client:
  auto_play: true          # Client-side autoplay
  auto_connect: true       # Client auto-connect

plugins:
  enabled: false

chat:
  enabled: false            # No chat panel

filetransfer:
  enabled: false            # No file transfer UI

capture:
  video:
    codec: h264
    ids: [fast_h264]
    pipelines:
      # VP8 pipeline - back to working baseline
      fast_vp8:
        width: "1024"
        height: "768"
        fps: "15"
        gst_encoder: "vp8enc"
        gst_params:
          target-bitrate: "750000"     # Keep working 750k bitrate
          cpu-used: "14"               # Push encoding speed further (was 10)
          deadline: "50000"            # More aggressive 50ms deadline (was 50ms)
          error-resilient: "1"         # Better for packet loss
          lag-in-frames: "0"           # No buffering for instant start
          min-quantizer: "6"           # Higher min quality (less CPU on low quality)
          max-quantizer: "28"          # Lower max quality (prioritize speed)
          threads: "1"                 # Single thread
          keyframe-max-dist: "15"      # Keyframe every second at 15fps
          token-partitions: "0"        # Simplest token partitioning
          # end-usage: "cbr"             # Constant bitrate mode for predictable dropping
          # buffer-size: "1000"          # 1 second buffer for rate control
          # buffer-initial-size: "250"   # Start with smaller buffer (250ms)
          # buffer-optimal-size: "500"   # Target buffer level (500ms)
        show_pointer: false
      # Optimized H.264 pipeline for fast connection and low delay
      fast_h264:
        width: "1024"
        height: "768"
        fps: "15"
        gst_encoder: "x264enc"
        gst_params:
          bitrate: "750"                # Match working VP8 bitrate (750 kbps)
          speed-preset: "ultrafast"     # Fastest encoding preset
          tune: "zerolatency"           # Minimize latency
          threads: "1"                  # Single thread for your CPU
          key-int-max: "15"             # Keyframe every second (fast recovery)
          min-keyint: "1"               # Allow keyframes as often as needed
          keyint: "15"                  # Regular keyframe interval
          intra-refresh: "true"         # Progressive keyframe delivery
          rc-lookahead: "0"             # No lookahead buffering
          sync-lookahead: "0"           # No sync lookahead
          ref: "1"                      # Single reference frame (fastest)
          bframes: "0"                  # No B-frames (immediate encoding)
          me: "dia"                     # Fastest motion estimation
          subme: "0"                    # Fastest subpixel motion estimation
          trellis: "0"                  # Disable trellis quantization
          aq-mode: "0"                  # Disable adaptive quantization
          psy: "false"                  # Disable psychovisual optimizations
          cabac: "false"                # Use CAVLC (faster than CABAC)
          deblock: "false"              # Disable deblocking filter
          scenecut: "0"                 # Disable scene cut detection
        show_pointer: false
  audio:
    enabled: false                   # Completely disable audio streaming
