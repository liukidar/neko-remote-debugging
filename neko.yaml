# Neko configuration for lightweight video streaming
# For detailed configuration options, please refer to the Neko documentation:
# https://neko.m1k1o.net/docs/v3/configuration#file

desktop:
  screen: "1024x768@15"

member:
  provider: anonymous
  anonymous:
    # Allow anyone to connect with full permissions
    can_login: true
    can_connect: true
    can_watch: true
    can_host: true
    can_share_media: true
    can_access_clipboard: true
    sends_inactive_cursor: false
    can_see_inactive_cursors: false

session:
  merciful_reconnect: true
  implicit_hosting: true   # Autoâ€‘host without UI interaction
  auto_login: true         # Automatically log in users
  auto_connect: true       # Automatically connect to the stream
  auto_play: true          # Automatically start video playback
  cookie:
    enabled: false

# Add webrtc section for autoplay
webrtc:
  auto_play: true          # Force WebRTC autoplay
  
# Add client settings for autoplay
client:
  auto_play: true          # Client-side autoplay
  auto_connect: true       # Client auto-connect

plugins:
  enabled: false

chat:
  enabled: false            # No chat panel

filetransfer:
  enabled: false            # No file transfer UI

capture:
  video:
    codec: vp8
    ids: [stable_vp8]
    pipelines:
      # Stable VP8 pipeline - works reliably at 15fps
      stable_vp8:
        width: "1024"
        height: "768"
        fps: "15"
        gst_encoder: "vp8enc"
        gst_params:
          target-bitrate: "1000000"  # 1 Mbps
          cpu-used: "8"              # Fast but stable (not maximum)
          deadline: "1000000"        # 1 second deadline (more stable)
          lag-in-frames: "0"         # No buffering
          error-resilient: "1"       # Better for packet loss
          min-quantizer: "4"         # Lower min quality (more stable)
          max-quantizer: "32"        # Higher max quality range
          threads: "1"               # Single thread
          keyframe-max-dist: "15"    # Keyframe every second at 15fps
          token-partitions: "0"      # Simple partitioning
          static-thresh: "1"         # Default static detection
          undershoot: "25"           # Allow 25% undershoot
          overshoot: "25"            # Allow 25% overshoot
        show_pointer: false
      # Fixed H.264 pipeline - no black screen
      fast_h264:
        width: "1024"
        height: "768"
        fps: "15"
        gst_encoder: "x264enc"
        gst_params:
          bitrate: "1000"            # 1000 kbps
          speed-preset: "ultrafast"
          tune: "zerolatency"
          threads: "1"
          key-int-max: "15"          # Keyframe every second
          sliced-threads: "false"    # Disable for compatibility
          sync-lookahead: "0"        # No lookahead
          rc-lookahead: "0"          # No rate control lookahead
          ref: "1"                   # Single reference frame
          bframes: "0"               # No B-frames
          weightb: "false"           # Disable weighted B-frames
          weightp: "0"               # Disable weighted P-frames
          me: "dia"                  # Fastest motion estimation
          subme: "0"                 # Fastest subpixel motion estimation
          trellis: "0"               # Disable trellis quantization
          aq-mode: "0"               # Disable adaptive quantization
          psy: "false"               # Disable psychovisual optimizations
        show_pointer: false
  audio:
    enabled: false                   # Completely disable audio streaming
