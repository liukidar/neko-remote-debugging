# Override base Neko PulseAudio process to disable it
[program:pulseaudio]
command=/bin/true
autostart=false
autorestart=false
priority=50
user=%(ENV_USER)s

# Chromium browser with remote debugging enabled
[program:chromium]
environment=HOME="/home/%(ENV_USER)s",USER="%(ENV_USER)s",DISPLAY="%(ENV_DISPLAY)s"
command=/bin/sh -c "exec /usr/bin/chromium \
  --remote-debugging-port=9222 \
  --remote-debugging-address=0.0.0.0 \
  --remote-allow-origins=* \
  --window-position=0,0 \
  --display=$DISPLAY \
  --user-data-dir=/tmp/chromium-profile \
  --no-first-run \
  --start-maximized \
  --disable-gpu \
  --disable-gpu-compositing \
  --disable-gpu-rasterization \
  --disable-software-rasterizer \
  --disable-accelerated-video-decode \
  --disable-accelerated-video-encode \
  --disable-gpu-memory-buffer-compositor-resources \
  --disable-gpu-memory-buffer-video-frames \
  --disable-gpu-process-crash-limit \
  --disable-gpu-program-cache \
  --disable-gpu-driver-bug-workarounds \
  --disable-gl-drawing-for-tests \
  --disable-vulkan \
  --disable-vulkan-fallback-to-gl-for-testing \
  --use-gl=swiftshader-webgl \
  --in-process-gpu \
  --renderer-process-limit=2 \
  --max-connections-per-host=15 \
  --enable-features=UseSkiaRenderer \
  --user-agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/CHROMIUM_VERSION_PLACEHOLDER Safari/537.36" \
  --aggressive-cache-discard \
  --memory-pressure-off \
  --max-tiles-for-interest-area=512 \
  --default-tile-width=512 \
  --default-tile-height=512 \
  --disable-component-update \
  --disable-sync \
  --load-extension=/home/neko/extension \
  --disable-plugins \
  --disable-default-apps \
  --disable-translate \
  --disable-hang-monitor \
  --disable-prompt-on-repost \
  --disable-domain-reliability \
  --disable-logging \
  --disable-notifications \
  --disable-permissions-api \
  --disable-client-side-phishing-detection \
  --disable-popup-blocking \
  --disable-web-app-installation \
  --disable-webgl \
  --disable-webgl2 \
  --disable-3d-apis \
  --autoplay-policy=document-user-activation-required \
  --disable-background-media-suspend \
  --disable-media-session-api \
  --disable-features=AutoplayIgnoreWebAudio,MediaEngagementBypassAutoplayPolicies \
  --alsa-output-device=null \
  --max_old_space_size=512 \
  --process-per-site \
  --max-gum-fps=15 \
  --aggressive-tab-discard \
  --purge-memory-button \
  $NEKO_CHROMIUM_FLAGS"

stopsignal=INT
autorestart=true
priority=800
user=%(ENV_USER)s
stdout_logfile=/var/log/neko/chromium.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=10
redirect_stderr=true

# Network proxy to enable external DevTools access
# Chromium binds DevTools to 127.0.0.1:9222 only, ignoring --remote-debugging-address
# This proxy forwards external connections from 0.0.0.0:9223 to Chromium's 127.0.0.1:9222
[program:debug-proxy]
command=socat TCP-LISTEN:9223,fork,reuseaddr TCP:127.0.0.1:9222
autorestart=true
priority=200
user=root
stdout_logfile=/var/log/neko/debug-proxy.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=10
redirect_stderr=true

# Window manager
# [program:openbox]
# environment=HOME="/home/%(ENV_USER)s",USER="%(ENV_USER)s",DISPLAY="%(ENV_DISPLAY)s"
# command=/usr/bin/openbox --config-file /etc/neko/openbox.xml
# autorestart=true
# priority=300
# user=%(ENV_USER)s
# stdout_logfile=/var/log/neko/openbox.log
# stdout_logfile_maxbytes=100MB
# stdout_logfile_backups=10
# redirect_stderr=true